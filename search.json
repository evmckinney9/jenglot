[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Evan's Blog",
    "section": "",
    "text": "Configuring an LXC container with an external VPN\n\n\n\n\n\n\nproxmox\n\n\ndevops\n\n\n\nThis guide explains how to integrate your LXC container with an external VPN service to enhance the privacy and security of your containerized applications. \n\n\n\n\n\nMar 20, 2024\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "posts/prox_vpn/index.html",
    "href": "posts/prox_vpn/index.html",
    "title": "Configuring an LXC container with an external VPN",
    "section": "",
    "text": "This guide explains how to integrate your LXC container with an external VPN service to enhance the privacy and security of your containerized applications.\n\nProxmox Virtual Environment: A server management platform that allows you to deploy, manage, and monitor LXC containers. For more information visit Proxmox VE.\nTTeck’s Proxmox Helper Scripts: These scripts make it easier to create and manage LXC containers. Learn more here.\n\nIn this guide, we will configure a qBittorrent LXC container to use WireGuard VPN as its network gateway. I selected AirVPN as the VPN provider due to its support for peer-to-peer (P2P) connections and port forwarding capabilities. However, the concepts and steps outlined here can be adapted to other VPN services and applications according to your needs.\n\n\n\n\n\n\nWarning\n\n\n\nPlease use this guide responsibly. I’m not an expert and cannot guarantee the security of your setup."
  },
  {
    "objectID": "posts/prox_vpn/index.html#wireguard-lxc",
    "href": "posts/prox_vpn/index.html#wireguard-lxc",
    "title": "Configuring an LXC container with an external VPN",
    "section": "WireGuard LXC",
    "text": "WireGuard LXC\nFirst, set up WireGuard LXC to integrate your container with the VPN:\n\nInstalling WireGuard LXC: Start by executing the script on your host machine and accept the default settings.\nbash -c \"$(wget -qLO - https://github.com/tteck/Proxmox/raw/main/ct/wireguard.sh)\"\n\n\n\nFigure 1: Initiating WireGuard LXC setup.\n\n\nAfter running the script, install necessary dependencies:\napt install openresolv\napt-get install iptables-persistent\nAcquiring the VPN Configuration:\n\nGo to AirVPN’s WireGuard configuration generator.\n\n\n\n\nFigure 2: Generating AirVPN WireGuard configuration.\n\n\n\nSelect Linux, the WireGuard protocol, and your preferred server location. This will generate a *.conf file with your VPN configuration.\n\n[Interface]\nAddress = 10.178.17.78,fd7d:76ee:e68f:a993:124c:7d1d:869c:84e7\nPrivateKey = [PRIVATE_KEY]\nMTU = 1320\nDNS = 10.128.0.1, fd7d:76ee:e68f:a993::1\n\n[Peer]\nPublicKey = PyLCXAQT8KkM4T+dUsOQfn+Ub3pGxfGlxkIApuig+hk=\nPresharedKey = [PRIVATE_KEY]\nEndpoint = america3.vpn.airdns.org:1637\nAllowedIPs = 0.0.0.0/0,::/0\nPersistentKeepalive = 15\nConfiguring WireGuard with AirVPN:\n\nCheck your current public IP address:\n\ncurl ifconfig.me\n\nUpdate the WireGuard configuration with AirVPN’s details (e.g., wg0.conf, but you can use any name if you are setting up multiple VPNs on the same LXC):\n\nnano /etc/wireguard/wg0.conf\n\nApply the new configuration and restart WireGuard:\n\nwg-quick down wg0\nwg-quick up wg0\nwg show\n\nConfirm the VPN is working by checking your new public IP address:\n\ncurl ifconfig.me\nYou should observe an IP address different from the one initially confirmed, indicating successful VPN integration.\n\n\n\nFigure 3: Verifying WireGuard VPN functionality"
  },
  {
    "objectID": "posts/prox_vpn/index.html#qbittorrent-lxc",
    "href": "posts/prox_vpn/index.html#qbittorrent-lxc",
    "title": "Configuring an LXC container with an external VPN",
    "section": "qBittorrent LXC",
    "text": "qBittorrent LXC\nNext, set up qBittorrent LXC for secure torrenting through the VPN:\n\nInstalling qBittorrent LXC: Start by executing the script on your host machine and accept the default settings.\nbash -c \"$(wget -qLO - https://github.com/tteck/Proxmox/raw/main/ct/qbittorrent.sh)\"\n\n\n\nFigure 4: Launching the qBittorrent LXC setup.\n\n\nAfter installation, access qBittorrent through your web browser at the provided URL:\nqBittorrent should be reachable by going to the following URL.\n         http://192.168.0.227:8090"
  },
  {
    "objectID": "posts/prox_vpn/index.html#network-bridge",
    "href": "posts/prox_vpn/index.html#network-bridge",
    "title": "Configuring an LXC container with an external VPN",
    "section": "Network bridge",
    "text": "Network bridge\nCreating a network bridge in Proxmox ensures direct communication between the WireGuard and qBittorrent containers:\n\nCreating a Proxmox Network Bridge:\n\nStart by creating a network bridge in the Proxmox interface, which may vary based on your setup.\n\n\n\n\nFigure 6: Configuring a new network bridge in Proxmox.\n\n\n\nApply the changes to activate the new network bridge.\n\n\n\n\nFigure 7: Finalizing network bridge setup.\n\n\nIntegrating LXCs with the Network Bridge:\n\nAssign the new bridge as a network device for both the WireGuard and qBittorrent LXCs, setting static IP addresses on this new subnet:\n\nWireGuard LXC: 10.10.10.1/24\nqBittorrent LXC: 10.10.10.2/24\n\n\n\n\n\nFigure 8: Assigning the network bridge to LXCs.\n\n\n\nTest the integration by pinging the qBittorrent LXC from the WireGuard LXC.\n\nping 10.10.10.2\n\n\n\nFigure 9: Verifying connectivity between LXCs.\n\n\nGateway Configuration:\n\nWireGuard LXC:\n\nEnable IP forwarding and establish NAT rules:\n\necho \"net.ipv4.ip_forward=1\" | tee -a /etc/sysctl.conf\nsysctl -p\niptables -t nat -A POSTROUTING -o wg0 -j MASQUERADE\n\nSave the iptables configuration to persist across reboots: bash       netfilter-persistent save\n\nqBittorrent LXC:\n\nDefine the WireGuard LXC as the default gateway. Update /etc/network/interfaces with the gateway and DNS settings.\n\nauto lo\niface lo inet loopback\n\nauto eth0\niface eth0 inet static\n    address 192.168.0.227 # [Your qBittorrent LXC's static IP]\n    netmask 255.255.255.0\n\nauto eth1\niface eth1 inet static\n    address 10.10.10.2/24\n    netmask 255.255.255.0\n    gateway 10.10.10.1\n    dns-nameservers 1.1.1.1\n    post-up ip route add default via 10.10.10.1 dev eth1\n    post-up ip route del default via 192.168.0.1 dev eth0 || true\n\n\n\n\n\n\nTip\n\n\n\nI recommend using a static IP address for the qBittorrent LXC as DHCP can cause issues with the setup’s persistence across reboots.\n\n\n\n\n\nFigure 10: Default routing through the VPN bridge.\n\n\n\nRestart network services to apply changes.\nConfirm the successful gateway configuration by verifying the IP address is now resolved through the VPN:\n\nping -c 4 google.com  # Test DNS resolution\ncurl ifconfig.me  # Should return the WireGuard IP\n\nIn case of any configuration issues, try bypassing Proxmox’s configuration checks:\n\ntouch /.pve-ignore.resolv.conf\ntouch /etc/network/.pve-ignore.interfaces"
  },
  {
    "objectID": "posts/prox_vpn/index.html#qbittorrent-client-configuration",
    "href": "posts/prox_vpn/index.html#qbittorrent-client-configuration",
    "title": "Configuring an LXC container with an external VPN",
    "section": "qBittorrent client configuration",
    "text": "qBittorrent client configuration\nFinally, configure the qBittorrent client to ensure secure torrenting through the VPN:\n\nPort Forwarding with AirVPN: Visit AirVPN’s port forwarding section to obtain a port to be forwarded through the VPN. This step is crucial for the qBittorrent client to establish direct connections with peers.\n\n\n\nFigure 6: Acquiring a forwarded port from AirVPN.\n\n\nqBittorrent WebUI:\n\nEnsure the security of your qBittorrent interface by setting a strong password.\n\n\n\n\nFigure 5: Configuring the webgui password for qBittorrent.*\n\n\nConfiguring the Listening Port: Access the settings in the qBittorrent WebUI and enter the listening port you received from AirVPN.\n\n\n\nFigure 7: Setting the listening port in qBittorrent.\n\n\nNetwork Interface Binding:\n\nBind qBittorrent to the network interface (eth1) and IP address (10.10.10.2) corresponding to the VPN connection to ensure all traffic goes through the VPN.\n\n\n\n\nFigure 8: Binding qBittorrent to a specific network interface.\n\n\n\n\nRemember to click Save to apply your changes."
  }
]